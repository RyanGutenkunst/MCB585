















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-08-23 21:10:15 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/mcb585/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/mcb585/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/mcb585/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/mcb585/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/mcb585/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/mcb585/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/mcb585/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/mcb585/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mcb585/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mcb585/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mcb585/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mcb585/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mcb585/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems: Survival Analysis</title>
  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://georgesutphin.github.io/MCB585/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/mcb585-logo.svg" alt="MCB585 logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-class-introduction/index.html">Getting started with R and RStudio</a></li>
            
            <li><a href="../01-oyo-introduction/index.html">Getting started with R and RStudio -- Additional Detail</a></li>
            
            <li><a href="../02-class-R-data-types-structures/index.html">Basic Data Types and Data Structures in R</a></li>
            
            <li><a href="../02-oyo-R-data-types-structures/index.html">R Data Types and Data Structures -- Additional Detail</a></li>
            
            <li><a href="../03-class-data-frames/index.html">Data Frames, Basic Indexing, Reading/Writing Data</a></li>
            
            <li><a href="../03-oyo-lists/index.html">Lists and Advanced Indexing</a></li>
            
            <li><a href="../04-class-manipulating-plotting-data/index.html">Manipulating and Plotting Data</a></li>
            
            <li><a href="../04-oyo-advanced-data-manipulation/index.html">Advanced Data Manipulation and Plotting</a></li>
            
            <li><a href="../05-class-decisions-loops/index.html">Decision Making and Loops</a></li>
            
            <li><a href="../05-oyo-more-decisions-loops/index.html">Decision Making and Loops -- Additional Detail</a></li>
            
            <li><a href="../06-class-distributions/index.html">Distributions and Normality</a></li>
            
            <li><a href="../06-oyo-more-distributions/index.html">Distributions and Normality -- Additional Detail</a></li>
            
            <li><a href="../07-class-hypothesis-testing/index.html">Hypothesis Testing</a></li>
            
            <li><a href="../07-oyo-multiple-test-correction/index.html">Multiple Test Correction</a></li>
            
            <li><a href="../08-class-survival-analysis/index.html">Survival Analysis</a></li>
            
            <li><a href="../08-oyo-advanced-survival-analysis/index.html">Advanced Survival Analysis</a></li>
            
            <li><a href="../09-class-power-analysis/index.html">Power Analysis</a></li>
            
            <li><a href="../09-oyo-simulation/index.html">Simulating Experiments</a></li>
            
            <li><a href="../99-projects/index.html">Final Projects</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	<!--
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	-->

	
        <li><a href="../LICENSE.html">About</a></li>
	<!--
	
	<li><a href="/edit//_episodes_rmd/08-class-survival-analysis.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	-->
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-oyo-multiple-test-correction/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../08-oyo-advanced-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Survival Analysis</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Class Date:</strong> 9/18/2020 -- In Class
      <br/>
      <strong>Teaching:</strong> 90 min
      <br/>
      <strong>Exercises:</strong> 30 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How is time-to-event data structured?</p>
</li>
	
	<li><p>What are the elements that separate time-to-event data from single-point observations?</p>
</li>
	
	<li><p>How do we visualize time-to-event data?</p>
</li>
	
	<li><p>What statistical tests are available for time-to-event data hypothesis testing?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the basic structure of time-to-event data.</p>
</li>
	
	<li><p>Understand censoring and how it affects time-to-event data.</p>
</li>
	
	<li><p>Use the <code class="highlighter-rouge">survival()</code> package to generate survival curves and age-specific mortality plots.</p>
</li>
	
	<li><p>Use the Wilcoxon Rank-Sum (aka Mann-Whitney U) and Log-Rank tests to evaluate statistical differences between time-to-event observations between groups.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<hr />
<h2 id="in-class">In Class</h2>

<p>So far we have mostly been dealing with data that meets that basic assumptions of a t-test or other common statistical tests. In this class, we are going to look at a category of data that requires special consideration. Time-to-event data (e.g. survival or lifespan data) violates several assumptions made by many of our standard tests:</p>

<ul>
  <li>It is not generally normally distributed.</li>
  <li>Observations are not independent (more below on this).</li>
  <li>Data is often censored.</li>
</ul>

<p>In the following sections we will examine common methods for formatting, displaying, and analyzing time-to-event data, and how to implement these methods in R.</p>

<hr />
<h4 id="missing-data-and-censoring">Missing data and censoring</h4>

<p>When you are dealing with time-to-event data, subjects are selected (aka sampled) and observed repeatedly until some event occurs (or does not occur). This opens the possibility that a study will be completed without an observation occurring. This can happen for a few reasons:</p>

<ul>
  <li>A subject is removed from the study (e.g. a patient in a drug trial stops taking the drug on their own)</li>
  <li>A related event occurs that precludes occurrence of the event of interest (e.g. a patient in a cancer drug trial is killed in a car accident; this prevents the event of interest, “death from cancer” from occurring)</li>
  <li>The study completed before an event occurred for a subject (but the subject is still in the study)</li>
</ul>

<p>There are three types of censoring:</p>

<ol>
  <li>Right-censoring: the event of interest occurs after some time <em>t</em>, but the specific time of is unknown.
    <ul>
      <li>e.g. subject dies of an unrelated cause</li>
      <li>e.g. subject is still alive at the end of the study</li>
    </ul>
  </li>
  <li>Left-censoring: an individual’s entry date is unknown (e.g. birthdate in lifespan studies).
    <ul>
      <li>e.g. a subject infected with a pathogen enters a study, but the infection date is unknown 3. Interval-censoring: the vent of interest occurred in a known interval, but the precise time is unknown.</li>
      <li>e.g. a patient is diagnosed with the disease of interest during a follow-up visit after a study concludes</li>
    </ul>
  </li>
</ol>

<p>Right-censoring is the most common (particularly when using a model organism in the lab, where birthdate or other entry criteria can be tightly controlled, but an individual exiting a study can happen for various reasons). We will examine right-censoring in this class.</p>

<blockquote class="callout">
  <h2 id="why-not-just-exclude-censored-data">Why not just exclude censored data?</h2>

  <p>One option for dealing with an unexpected event (e.g. your mouse escapes 18 months 
into your lifespan study) is to just leave out the data for that individual. This has
at least two problems for your analysis:</p>

  <ul>
    <li>What if the unexpected event is correlated with you outcome of interest? For example,
perhaps only mice that are still healthy and likely to have a long remaining lifespan
will be capable of escaping at 18 months of age. By not considering these mice, you will 
shift the distribution.</li>
    <li>Because the procedure in these studies is to (1) select a sample, and (2) make repeated
observations until the event occurs, we already have observations collected up until 
the time point when an individual is censored. Removing the individual from the analysis
removes potentially valuable data (e.g. the mouse live at least 18 months).</li>
  </ul>
</blockquote>

<hr />
<h3 id="survival-curves">Survival curves</h3>

<p>The most common form of data presented for time-to-event data is the survival curve. The curve shows the fraction or percentage of the population surviving at a given time. The time measure can be age (as is the case for lifespan) or some other relevant defined point (e.g. diagnosis with a disease, cancer remission, time of treatment).</p>

<p><img src="../fig/generic-survival-curve.png" alt="Survival Curve" /></p>

<p>Of course, we generally don’t know the survival for every individual in the population and need to draw a best estimate from our sample data. To deal with this issue, we use two tools called the <em>Life Table</em>, to generate information about the survival characteristics over time, and <em>Kaplan-Meier curves</em> to draw approximate survival curves from sample data.</p>

<p> </p>
<h4 id="the-life-table">The Life Table</h4>

<p>The <em>Life Table</em> is a systematic way to tabulate observations and estimate survival parameters based on sample data. A Life Table has the following basic information:</p>

<p><img src="../fig/life-table-partial.png" alt="Partial Life Table" /></p>

<ul>
  <li><script type="math/tex">t_0</script> start time, relative to the time period of interest (e.g. for lifespan data, each individual’s birth is set to time 0, even if they were born on different dates)</li>
  <li><script type="math/tex">t</script> observation time</li>
  <li><script type="math/tex">d_t</script> number of events observed at at time t</li>
  <li><script type="math/tex">n_0 = \sum d_t</script> original sample size (number of individuals in the sample prior to censoring or events)</li>
  <li><script type="math/tex">n_t = n_0 - \sum_{x = 0}^{t-1} d_x</script> number of individuals at risk at time t (e.g. sampled, uncensored individuals with no event by time t)</li>
  <li><script type="math/tex">l_t = \frac{n_t}{n_0}</script> fraction of the sample remaining at risk by time t</li>
  <li><script type="math/tex">S(t) \approx l_t</script> survival function, the fraction of the population at risk (aka “surviving to”) time t</li>
</ul>

<p>We estimate the survival function by plotting <script type="math/tex">l_t</script> vs. age <script type="math/tex">t</script>. Let’s examine the survival of the US population as an example. The life table is stored in <code class="highlighter-rouge">S2011.life.table.txt</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/US2011.life.table.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'data.frame':	101 obs. of  7 variables:
 $ age: int  0 1 2 3 4 5 6 7 8 9 ...
 $ qx : num  0.006058 0.000415 0.000264 0.000208 0.000167 ...
 $ lx : int  100000 99394 99353 99327 99306 99289 99274 99261 99249 99239 ...
 $ dx : chr  "606" "41" "26" "21" ...
 $ Lx : int  99470 99374 99340 99316 99298 99282 99268 99255 99244 99234 ...
 $ Tx : int  7870915 7771445 7672071 7572731 7473415 7374117 7274835 7175567 7076312 6977068 ...
 $ ex : num  78.7 78.2 77.2 76.2 75.3 74.3 73.3 72.3 71.3 70.3 ...
</code></pre></div></div>

<p> </p>

<p>Note that what I called <script type="math/tex">n_t</script> this particular data set calls <script type="math/tex">l_x</script> (and that all subscripts are “x” instead of “t”). Some of the above variables (e.g. our <script type="math/tex">l_t</script>) are missing. To start, let’s rename the variables to match our convention and calculate <script type="math/tex">l_t</script>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># rename life table variables</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"t"</span><span class="p">,</span><span class="s2">"qt"</span><span class="p">,</span><span class="s2">"nt"</span><span class="p">,</span><span class="s2">"dt"</span><span class="p">,</span><span class="s2">"Lt"</span><span class="p">,</span><span class="s2">"Tt"</span><span class="p">,</span><span class="s2">"et"</span><span class="p">)</span><span class="w">

</span><span class="c1"># calculate l{t}</span><span class="w">
</span><span class="n">lt</span><span class="o">$</span><span class="n">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lt</span><span class="o">$</span><span class="n">nt</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">nt</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  t       qt     nt  dt    Lt      Tt   et      lt
1 0 0.006058 100000 606 99470 7870915 78.7 1.00000
2 1 0.000415  99394  41 99374 7771445 78.2 0.99394
3 2 0.000264  99353  26 99340 7672071 77.2 0.99353
4 3 0.000208  99327  21 99316 7572731 76.2 0.99327
5 4 0.000167  99306  17 99298 7473415 75.3 0.99306
6 5 0.000151  99289  15 99282 7374117 74.3 0.99289
</code></pre></div></div>

<p> </p>

<p>Now we can plot the survival curve:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="n">lt</span><span class="o">$</span><span class="n">lt</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"US Survival 2011"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Age (years)"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Fraction Surviving"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>Great! That looks like a standard survival curve to me. We can see that median lifespan is around 85 years and maximum is out around 100. The tip of the tail, which won’t appear on this chart, which only has ~100,000 people, is really out at 122 or so.</p>

<p>From the equation for <script type="math/tex">l_t</script>, we can see that it depends on <script type="math/tex">n_t</script>, which in turn depends on all of the previously observed events (<script type="math/tex">d_0</script> to <script type="math/tex">d_t-1</script>). Thus the survival function cannot be considered an variable with independent observations. This is one reason we can’t use a t-test to make comparisons. For that we need to look at a different aspect of time-to-event data. A complete life table will have a few more columns:</p>

<p><img src="../fig/life-table-full.png" alt="Full Life Table" /></p>

<ul>
  <li><script type="math/tex">p_t = l_{t+1}/l_t</script> probability that someone with no event at time t will still have no event by time t + 1.</li>
  <li><script type="math/tex">q_t = 1 - p_t</script> probability that someone with no event at time t will experience the event by time t + 1.</li>
  <li><script type="math/tex">\lambda(t) = -\frac{\delta}{dx} ln[S(x)] \approx -ln(p_t)</script> instantaneous rate at which the event occurs at time t; the slope of the log of the survival function.</li>
</ul>

<p>The last variable, <script type="math/tex">\lambda(t)</script> is called the hazard function (aka hazard rate, <script type="math/tex">h(x)</script>), or in the context of survival data, age-specific mortality or force of mortality (<script type="math/tex">\mu_x</script>). Conceptually, age-specific mortality represents the change of an individual dying at that specific age.</p>

<p><script type="math/tex">\lambda(t)</script>, while not normally distributed, does not depend on previous observations, and can thus be considered a variable for which observations are independent. This allows us to make statistical comparisons. Let’s look at how <script type="math/tex">\lambda(t)</script> behaves.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># calculate pt and lambdat</span><span class="w">
</span><span class="n">lt</span><span class="o">$</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lt</span><span class="o">$</span><span class="n">qt</span><span class="w">
</span><span class="n">lt</span><span class="o">$</span><span class="n">lambdat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">pt</span><span class="p">)</span><span class="w">

</span><span class="c1"># plot age specific mortality -- does the shape look familiar?</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt</span><span class="o">$</span><span class="n">lambdat</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"US Age-Specific Mortality 2011"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Age (years)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Age-Specific Mortality"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>Does that shape look familiar? It appears to increase exponentially with age. Try plotting the y-axis on a log-scale (using the <code class="highlighter-rouge">log = "y"</code> argument in plot) (alternatively, we could also plot <code class="highlighter-rouge">log(lt$lambdat)</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt</span><span class="o">$</span><span class="n">lambdat</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"US Age-Specific Mortality 2011"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Age (years)"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Age-Specific Mortality"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>Despite the some odd behavior during the early part of life, age-specific mortality appears to increase linearly during the majority of adulthood. That looks like something we can model!</p>

<blockquote class="callout">
  <h2 id="minimum-age-specific-mortality">Minimum age-specific mortality</h2>

  <p>As an aside, what is up with that minimum point? At what age does that occur?</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lt</span><span class="o">$</span><span class="n">t</span><span class="p">[</span><span class="n">which.min</span><span class="p">(</span><span class="n">lt</span><span class="o">$</span><span class="n">lambdat</span><span class="p">)]</span><span class="w">
</span></code></pre></div>  </div>

  <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 10
</code></pre></div>  </div>

  <p> </p>

  <p>What happens to humans at roughly 10 years of age? Puberty! Thinking from an 
evolutionary perspective, it makes sense that the minimum change of dying should
occur at the point of maximum reproductive potential. Ability to reproduce is 
a primary driver of species survival, and remaining reproductive potential only
decreases with increasing age.</p>

  <p>Incidentally, this is one of the major categories of theory for why we age in 
the first place. It isn’t so much that aging is selected for, but that the decline
in “remaining reproductive potential” decreases as we get older, and thus the selection
pressure steadily reduces. If an allele gives us a boost to reproduction or health 
early in life, it may be selected for even if it causes a fatal disease later in life.</p>
</blockquote>

<p> </p>
<h4 id="kaplan-meier-curves">Kaplan-Meier curves</h4>

<p>We never actually know the “real” shape of the survival curve for our population, or even our sample, because of the structure of time-to-event data. This is true for two reasons:</p>

<ul>
  <li>We often have missing data that requires censoring (i.e. the event was never observed)</li>
  <li>Subjects are only observed at discrete time points, so we don’t have access to the exact time that the event occurred. We instead know that the event had not occurred at some time <em>t - 1</em>, but that the event had occurred by time <em>t</em>.</li>
</ul>

<p>There is a type of survival curve estimator called the Kaplan-Meier curve which allows us to approximate the shape of the survival curve for a given set of time-to-event observations. Kaplan-Meier curves have the following properties.</p>

<ul>
  <li>Estimates true survival curve when data is missing (i.e. when one or more observations is censored)</li>
  <li>Assumes that no deaths occur between observation times (i.e. approximates that each event occurred at the observation time, rather than at some unknown time between observations)</li>
  <li>Tick marks are used to indicate time at which a subject was censored for missing data.</li>
  <li>For the purposes of drawing the curve, censored individuals are included in the “total” or “at risk” sample size up until the time point where they were censored. After that point, the change in curve height for a new event occurrence is dependent on the reduced sample size with out the censored individual.</li>
</ul>

<p>This is because the pool of patients remaining “at risk” for the event drops when either an event is experienced or when a patient is censored.</p>

<p><img src="../fig/kaplan-meier-curve.jpg" alt="Kaplan-Meier Curve" /></p>

<p>When an event occurs, the curve drops by a fraction of the remaining “at risk” pool <em>at that time point</em>. As patients are censored without an observed event, the remaining “at risk” pool decreases. Thus subsequent events drop the remaining % remaining by a larger and larger margin. A good step-by-step guide to how Kaplan-Meier curves are drawn can be found <a href="https://towardsdatascience.com/kaplan-meier-curves-c5768e349479">here</a>.</p>

<p>Let’s look at our inbred mouse data for an example. Make sure that the <code class="highlighter-rouge">survival</code> package is loaded, and read in the mouse lifespan data. For our purposes, let’s look specifically at the strain BUB/BnJ, which has some mice censored.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load survival package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"survival"</span><span class="p">)</span><span class="w">

</span><span class="c1"># read in inbred strain lifespan data</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">

</span><span class="c1"># grab the subset of data for BUB/BnJ </span><span class="w">
</span><span class="n">surv.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"BUB/BnJ"</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>For survival analysis, the survival packages uses an odd notation for simulating the survival curve. In order to include data censoring, instead of using <code class="highlighter-rouge">lifespan_days</code> directly as the dependent variable, we use the notation <code class="highlighter-rouge">Surv(time, event status)</code>. This tells R that we have a set of censored survival data with observed event times (<code class="highlighter-rouge">lifespan_days</code>), and some mice that were censored and not observed to have died (<code class="highlighter-rouge">censor</code>).</p>

<p>In our case, we use the <code class="highlighter-rouge">lifespan_days</code> as the time that we observed the event, and <code class="highlighter-rouge">censor</code> as our status variable. An important note: what <code class="highlighter-rouge">Surv()</code> wants for status is whether the event occurred. In this particular data set, the event was assumed to occur unless something odd happened (e.g. the mouse escaped), so <code class="highlighter-rouge">censor</code> is “0” when the mouse died (the event occurred) and “1” when something else happened (e.g. the mouse was “censored” and removed from the study because death, the event, was never observed). Thus we need to tell R that <code class="highlighter-rouge">censor == 0</code> means “the event occurred”.</p>

<p>The <code class="highlighter-rouge">survfit()</code> function builds the life table that we need for our analyses. We embed the <code class="highlighter-rouge">Surv()</code> object as the dependent variable in side the <code class="highlighter-rouge">survfit()</code> function. <code class="highlighter-rouge">survfit()</code> <em>always</em> needs an independent variable. If you want to just plot all of the data as a single curve, you can just give it “1”:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># calculate life table for BUB/BnJ mice</span><span class="w">
</span><span class="n">survfit.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">censor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">surv.bub</span><span class="p">)</span><span class="w">

</span><span class="c1"># use summary() to look at the life table</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">survfit.bub</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call: survfit(formula = Surv(lifespan_days, censor == 0) ~ 1, data = surv.bub)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
  260     52       1   0.9808  0.0190      0.94414        1.000
  266     51       1   0.9615  0.0267      0.91066        1.000
  279     47       1   0.9411  0.0330      0.87852        1.000
  287     46       1   0.9206  0.0381      0.84885        0.998
  301     45       1   0.9002  0.0424      0.82076        0.987
  307     44       1   0.8797  0.0461      0.79380        0.975
  328     43       1   0.8592  0.0494      0.76772        0.962
  341     42       1   0.8388  0.0523      0.74236        0.948
  343     41       1   0.8183  0.0549      0.71759        0.933
  354     40       2   0.7774  0.0592      0.66954        0.903
  357     38       1   0.7570  0.0611      0.64616        0.887
  366     37       1   0.7365  0.0628      0.62315        0.870
  383     35       1   0.7155  0.0644      0.59969        0.854
  426     34       1   0.6944  0.0659      0.57658        0.836
  447     33       1   0.6734  0.0672      0.55380        0.819
  455     32       1   0.6523  0.0683      0.53133        0.801
  457     31       1   0.6313  0.0692      0.50916        0.783
  493     30       1   0.6102  0.0701      0.48727        0.764
  495     29       1   0.5892  0.0707      0.46566        0.746
  523     28       1   0.5682  0.0713      0.44431        0.727
  538     27       1   0.5471  0.0717      0.42322        0.707
  551     26       1   0.5261  0.0719      0.40239        0.688
  608     25       1   0.5050  0.0721      0.38180        0.668
  621     24       1   0.4840  0.0721      0.36147        0.648
  628     23       1   0.4629  0.0719      0.34138        0.628
  635     22       1   0.4419  0.0717      0.32154        0.607
  670     21       1   0.4209  0.0713      0.30195        0.587
  678     20       1   0.3998  0.0708      0.28261        0.566
  693     19       2   0.3577  0.0693      0.24472        0.523
  722     17       1   0.3367  0.0683      0.22618        0.501
  726     16       1   0.3156  0.0672      0.20792        0.479
  768     15       1   0.2946  0.0660      0.18996        0.457
  810     14       1   0.2736  0.0645      0.17230        0.434
  818     13       1   0.2525  0.0629      0.15498        0.411
  855     12       1   0.2315  0.0611      0.13801        0.388
  867     11       1   0.2104  0.0590      0.12143        0.365
  873     10       1   0.1894  0.0568      0.10526        0.341
  874      9       1   0.1683  0.0542      0.08955        0.316
  875      8       1   0.1473  0.0514      0.07438        0.292
  888      7       1   0.1263  0.0481      0.05980        0.267
  889      6       2   0.0842  0.0403      0.03297        0.215
  904      4       1   0.0631  0.0353      0.02112        0.189
  965      3       1   0.0421  0.0291      0.01084        0.163
 1020      2       1   0.0210  0.0208      0.00303        0.146
 1034      1       1   0.0000     NaN           NA           NA
</code></pre></div></div>

<p> </p>

<p>Now that we have the survival function, the <code class="highlighter-rouge">plot()</code> function knows what we want to do with it: plot the Kaplan-Meier curve:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the Kaplan-Meier curve</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">survfit.bub</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time (days)"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Fraction surviving"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">conf.int</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">              </span><span class="c1"># turn of confidence intervals</span><span class="w">
     </span><span class="n">mark.time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">            </span><span class="c1"># mark time of censor</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"BUB/BnJ Survival"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-10-1.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>We can also break the data down into the two sexes. We do this using the dependent variable at the <code class="highlighter-rouge">survfit()</code> step:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># calculate life table for BUB/BnJ mice</span><span class="w">
</span><span class="n">survfit.bub.sex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">censor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">surv.bub</span><span class="p">)</span><span class="w">

</span><span class="c1"># use summary() to look at the life table</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">survfit.bub.sex</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call: survfit(formula = Surv(lifespan_days, censor == 0) ~ sex, data = surv.bub)

                sex=f 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
  266     24       1   0.9583  0.0408      0.88163        1.000
  279     23       1   0.9167  0.0564      0.81250        1.000
  328     22       1   0.8750  0.0675      0.75221        1.000
  343     21       1   0.8333  0.0761      0.69681        0.997
  357     20       1   0.7917  0.0829      0.64478        0.972
  455     19       1   0.7500  0.0884      0.59531        0.945
  457     18       1   0.7083  0.0928      0.54795        0.916
  495     17       1   0.6667  0.0962      0.50240        0.885
  523     16       1   0.6250  0.0988      0.45845        0.852
  538     15       1   0.5833  0.1006      0.41598        0.818
  551     14       1   0.5417  0.1017      0.37489        0.783
  621     13       1   0.5000  0.1021      0.33513        0.746
  628     12       1   0.4583  0.1017      0.29668        0.708
  635     11       1   0.4167  0.1006      0.25954        0.669
  670     10       1   0.3750  0.0988      0.22373        0.629
  678      9       1   0.3333  0.0962      0.18930        0.587
  722      8       1   0.2917  0.0928      0.15636        0.544
  726      7       1   0.2500  0.0884      0.12502        0.500
  810      6       1   0.2083  0.0829      0.09551        0.454
  818      5       1   0.1667  0.0761      0.06813        0.408
  867      4       1   0.1250  0.0675      0.04337        0.360
  904      3       1   0.0833  0.0564      0.02211        0.314
  965      2       1   0.0417  0.0408      0.00612        0.284
 1034      1       1   0.0000     NaN           NA           NA

                sex=m 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
  260     28       1   0.9643  0.0351      0.89794        1.000
  287     24       1   0.9241  0.0517      0.82807        1.000
  301     23       1   0.8839  0.0632      0.76836        1.000
  307     22       1   0.8438  0.0720      0.71386        0.997
  341     21       1   0.8036  0.0790      0.66280        0.974
  354     20       2   0.7232  0.0892      0.56792        0.921
  366     18       1   0.6830  0.0929      0.52328        0.892
  383     16       1   0.6403  0.0964      0.47678        0.860
  426     15       1   0.5977  0.0989      0.43205        0.827
  447     14       1   0.5550  0.1007      0.38893        0.792
  493     13       1   0.5123  0.1016      0.34732        0.756
  608     12       1   0.4696  0.1017      0.30718        0.718
  693     11       2   0.3842  0.0995      0.23125        0.638
  768      9       1   0.3415  0.0972      0.19552        0.597
  855      8       1   0.2988  0.0939      0.16137        0.553
  873      7       1   0.2561  0.0897      0.12894        0.509
  874      6       1   0.2134  0.0843      0.09843        0.463
  875      5       1   0.1708  0.0775      0.07016        0.416
  888      4       1   0.1281  0.0689      0.04463        0.368
  889      3       2   0.0427  0.0417      0.00628        0.290
 1020      1       1   0.0000     NaN           NA           NA
</code></pre></div></div>

<p> </p>

<p>And now <code class="highlighter-rouge">plot()</code> to generate the Kaplan-Meier curves:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the Kaplan-Meier curve</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">survfit.bub.sex</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time (days)"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Fraction surviving"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w">
     </span><span class="n">conf.int</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">              </span><span class="c1"># turn of confidence intervals</span><span class="w">
     </span><span class="n">mark.time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">            </span><span class="c1"># mark time of censor</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"BUB/BnJ Survival"</span><span class="p">)</span><span class="w">

</span><span class="c1"># add legend</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
       </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">),</span><span class="w">
       </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"f"</span><span class="p">,</span><span class="s2">"m"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-12-1.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" width="612" style="display: block; margin: auto;" /></p>

<hr />
<h3 id="the-log-rank-test">The Log-Rank Test</h3>

<p>Now we can visualize our lifespan data. How doe we compare different groups? The most common test for lifespan data is the Log-Rank Test (aka the Mantel-Cox Test). The Log-Rank Test makes the assumption that the survival functions (<script type="math/tex">S(t)</script>) are the same for the two groups under the null hypothesis (essentially, this means that any censoring is correlated with survival). What the test does it:</p>

<ol>
  <li>Assume that the survival is equal and that any censoring does not impact the survival function.</li>
  <li>At each observation point, calculate the difference in the number of observed events between comparison groups.</li>
  <li>Sum the differences across time points to calculate the test statistics: <script type="math/tex">z = \frac{\sum_{j=1}^{J} (O_{1j} - O_{2j})}{\sqrt{\sum_{j=1}^{J} V_j}}</script></li>
  <li>This test statistic is approximately normally distributed and can be used to calculate the probability that the observed difference represents a sample from the null distribution (or not) at a given <script type="math/tex">\alpha</script>.</li>
</ol>

<p>In R, the <code class="highlighter-rouge">survdiff()</code> function performs a Log-Rank test using the same dependent and independent variable format as <code class="highlighter-rouge">survfit()</code>. Let’s use it to see if there are differences in lifespan between male and female BUB/BnJ mice:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">logrank.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survdiff</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">censor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.bub</span><span class="p">)</span><span class="w">
</span><span class="n">logrank.bub</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call:
survdiff(formula = Surv(lifespan_days, censor == 0) ~ sex, data = surv.bub)

       N Observed Expected (O-E)^2/E (O-E)^2/V
sex=f 32       24     24.1  0.000882   0.00189
sex=m 32       24     23.9  0.000893   0.00189

 Chisq= 0  on 1 degrees of freedom, p= 1 
</code></pre></div></div>

<p>So there is no difference in lifespan between male and female BUB/BnJ mice. There is a quirk with the <code class="highlighter-rouge">survdiff()</code> funciton in R. How do you extract the P-value? Looking at the survdiff object, there doesn’t seem to be a clear way:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">logrank.bub</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>List of 6
 $ n    : 'table' int [1:2(1d)] 32 32
  ..- attr(*, "dimnames")=List of 1
  .. ..$ groups: chr [1:2] "sex=f" "sex=m"
 $ obs  : num [1:2] 24 24
 $ exp  : num [1:2] 24.1 23.9
 $ var  : num [1:2, 1:2] 11.3 -11.3 -11.3 11.3
 $ chisq: num 0.00189
 $ call : language survdiff(formula = Surv(lifespan_days, censor == 0) ~ sex, data = surv.bub)
 - attr(*, "class")= chr "survdiff"
</code></pre></div></div>

<p> </p>

<p>Similar to how a t-test uses the t-distrubution (which is a modified normal distribution) to calculate a P-value based on the area under a well-defined portion of the probability density curve, the log-rank test calculates a different statisitcs, called <script type="math/tex">\chi</script>, and uses another well-defined distribution, the <script type="math/tex">\chi^2</script> distribution, to calculate P-values.</p>

<p>For an obscure and mathematcially dense reason, the creator of the <code class="highlighter-rouge">survdiff()</code> function decided not to directly report the P-value in the output of the function. However, he did include the cacluated value of <script type="math/tex">\chi^2</script>, and R includes a function that defines the <script type="math/tex">\chi^2</script> distrubtion, so we can realtively easily calculate it for ourselves.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># extract the value of the chi-squared statistic from the survdiff object</span><span class="w">
</span><span class="c1"># we also need the number of samples in each comparison group, </span><span class="w">
</span><span class="c1"># which defines the degrees of freedom for the test</span><span class="w">
</span><span class="n">chisq.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">logrank.bub</span><span class="o">$</span><span class="n">chisq</span><span class="w">
</span><span class="n">n.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">logrank.bub</span><span class="o">$</span><span class="n">n</span><span class="w">

</span><span class="c1"># use the chisq statistic to calculate the P-value</span><span class="w">
</span><span class="n">P.bub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pchisq</span><span class="p">(</span><span class="n">chisq.bub</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n.bub</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">

</span><span class="n">P.bub</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] 0.9653378
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="summary-of-survival-package-notation-in-r">Summary of survival package notation in R</h2>

  <ul>
    <li>Surv(age, event) ~ groups</li>
    <li>Creates a “survival object” that is basically just a function that indicates the 
 comparison we are interested in making</li>
    <li>“age” = age that the event occurred</li>
    <li>“event” = had the event (e.g. death) occurred at observation (1 = yes, 0 = no)</li>
    <li>
      <p>“groups” = data subsets to compare (e.g. sex, genotype)</p>
    </li>
    <li>survfit(Surv(age, event) ~ groups)</li>
    <li>Generates a life table from a survival object, separated by groups</li>
    <li>
      <p>Used for plotting survival curves</p>
    </li>
    <li>survdiff(Surv(age, event) ~ groups))</li>
    <li>Conducts a log-rank test between groups</li>
  </ul>
</blockquote>

<hr />
<h3 id="exercises">Exercises</h3>

<blockquote class="challenge">
  <h2 id="differences-in-male-vs-female-survival-and-mortality-in-moder-us-humans">Differences in male vs. female survival and mortality in moder US humans</h2>

  <p>Earlier we looked at survival and mortality in the US population. Now let’s
see how these differ by sex. Plot male and female survival and age-specific 
mortality  on the same plot for comparison. The life tables are stored in 
<code class="highlighter-rouge">US2011.life.table.male.txt</code> and <code class="highlighter-rouge">US2011.life.table.female.txt</code>, respectively.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data</span><span class="w">
</span><span class="n">lt.male</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/US2011.life.table.male.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">lt.female</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"./data/US2011.life.table.female.txt"</span><span class="p">)</span><span class="w">

</span><span class="c1"># change names to our convention</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">lt.male</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"t"</span><span class="p">,</span><span class="s2">"qt"</span><span class="p">,</span><span class="s2">"nt"</span><span class="p">,</span><span class="s2">"dt"</span><span class="p">,</span><span class="s2">"Lt"</span><span class="p">,</span><span class="s2">"Tt"</span><span class="p">,</span><span class="s2">"et"</span><span class="p">)</span><span class="w">

</span><span class="c1"># calculate lt, pt, and lambdat</span><span class="w">
</span><span class="n">lt.male</span><span class="o">$</span><span class="n">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lt.male</span><span class="o">$</span><span class="n">nt</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="n">lt.male</span><span class="o">$</span><span class="n">nt</span><span class="p">)</span><span class="w">
</span><span class="n">lt.male</span><span class="o">$</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lt.male</span><span class="o">$</span><span class="n">qt</span><span class="w">
</span><span class="n">lt.male</span><span class="o">$</span><span class="n">lambdat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="n">lt.male</span><span class="o">$</span><span class="n">pt</span><span class="p">)</span><span class="w">

</span><span class="c1"># change names to our convention (lx -&gt; nx)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">lt.female</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"t"</span><span class="p">,</span><span class="s2">"qt"</span><span class="p">,</span><span class="s2">"nt"</span><span class="p">,</span><span class="s2">"dt"</span><span class="p">,</span><span class="s2">"Lt"</span><span class="p">,</span><span class="s2">"Tt"</span><span class="p">,</span><span class="s2">"et"</span><span class="p">)</span><span class="w">

</span><span class="c1"># calculate lt, pt, and lambdat</span><span class="w">
</span><span class="n">lt.female</span><span class="o">$</span><span class="n">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lt.female</span><span class="o">$</span><span class="n">nt</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="n">lt.female</span><span class="o">$</span><span class="n">nt</span><span class="p">)</span><span class="w">
</span><span class="n">lt.female</span><span class="o">$</span><span class="n">pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lt.female</span><span class="o">$</span><span class="n">qt</span><span class="w">
</span><span class="n">lt.female</span><span class="o">$</span><span class="n">lambdat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="n">lt.female</span><span class="o">$</span><span class="n">pt</span><span class="p">)</span><span class="w">

</span><span class="c1"># plot survival curves</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">lt.female</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt.female</span><span class="o">$</span><span class="n">lt</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"US Survival 2011"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Age (years)"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Fraction Surviving"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">lt.male</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt.male</span><span class="o">$</span><span class="n">lt</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-16-1.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" width="612" style="display: block; margin: auto;" /></p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plot age-specific mortality</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">lt.female</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt.female</span><span class="o">$</span><span class="n">lambdat</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"US Age-Specific Mortality 2011"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Age (years)"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Age-Specific mortality"</span><span class="p">)</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">lt.male</span><span class="o">$</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">lt.male</span><span class="o">$</span><span class="n">lambdat</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-16-2.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="example-3-leukemia--log-rank-test-survdiff-function">Example 3: Leukemia – log-rank test (survdiff function)</h2>

  <p>The survival package includes the Acute Myelogenous Leukemia (AML) survival dataset.
Open the help for <code class="highlighter-rouge">aml</code> for a description of the data. the “x” column indicates whether
a particular chemotherapy treatment was continued/maintained or discontinued.</p>

  <ol>
    <li>Open and examine the data, and plot a Kaplan-Meier curve for all data.</li>
    <li>Plot the Kaplan-Meier curves broken down by treatment, and calculate the
Log-Rank P-value to determine whether the differences are signifcant.</li>
    <li>Extra challenge: extract the life tables for treated and untreated individuals
and plot age-specific morality</li>
  </ol>

  <p>The data is stored in the <code class="highlighter-rouge">aml</code> dataframe, which is loaded with the `survival package.</p>

  <p>*Note: unlike our mouse data, the <code class="highlighter-rouge">status</code> variable indicates whether a patient has died,
not patients that were censored. Be sure to indicate this appropriately in the <code class="highlighter-rouge">Surv()</code> 
object: `Surv(time, status == 1).</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load the survival package</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"survival"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Examine the data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">aml</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  time status          x
1    9      1 Maintained
2   13      1 Maintained
3   13      0 Maintained
4   18      1 Maintained
5   23      1 Maintained
6   28      0 Maintained
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create the life table for the aml data (all combined)</span><span class="w">
</span><span class="n">survfit.aml</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">aml</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">survfit.aml</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call: survfit(formula = Surv(time, status == 1) ~ 1, data = aml)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    5     23       2   0.9130  0.0588       0.8049        1.000
    8     21       2   0.8261  0.0790       0.6848        0.996
    9     19       1   0.7826  0.0860       0.6310        0.971
   12     18       1   0.7391  0.0916       0.5798        0.942
   13     17       1   0.6957  0.0959       0.5309        0.912
   18     14       1   0.6460  0.1011       0.4753        0.878
   23     13       2   0.5466  0.1073       0.3721        0.803
   27     11       1   0.4969  0.1084       0.3240        0.762
   30      9       1   0.4417  0.1095       0.2717        0.718
   31      8       1   0.3865  0.1089       0.2225        0.671
   33      7       1   0.3313  0.1064       0.1765        0.622
   34      6       1   0.2761  0.1020       0.1338        0.569
   43      5       1   0.2208  0.0954       0.0947        0.515
   45      4       1   0.1656  0.0860       0.0598        0.458
   48      2       1   0.0828  0.0727       0.0148        0.462
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the basic Kaplan-Meier curve for aml. Don't print the confidence interval.</span><span class="w">
</span><span class="c1"># We'll leave the 95% confidence intervals in place for fun.</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">survfit.aml</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time (weeks)"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Fraction surviving"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">mark.time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
     </span><span class="n">main</span><span class="o">=</span><span class="s2">"Survival in AML"</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-17-1.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" width="612" style="display: block; margin: auto;" /></p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create aml life tables and KM plots broken out by treatment (x,  "Maintained" vs. "Not maintained")</span><span class="w">
</span><span class="n">survfit.aml.by.rx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aml</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">survfit.aml.by.rx</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call: survfit(formula = Surv(time, status == 1) ~ x, data = aml)

                x=Maintained 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    9     11       1    0.909  0.0867       0.7541        1.000
   13     10       1    0.818  0.1163       0.6192        1.000
   18      8       1    0.716  0.1397       0.4884        1.000
   23      7       1    0.614  0.1526       0.3769        0.999
   31      5       1    0.491  0.1642       0.2549        0.946
   34      4       1    0.368  0.1627       0.1549        0.875
   48      2       1    0.184  0.1535       0.0359        0.944

                x=Nonmaintained 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    5     12       2   0.8333  0.1076       0.6470        1.000
    8     10       2   0.6667  0.1361       0.4468        0.995
   12      8       1   0.5833  0.1423       0.3616        0.941
   23      6       1   0.4861  0.1481       0.2675        0.883
   27      5       1   0.3889  0.1470       0.1854        0.816
   30      4       1   0.2917  0.1387       0.1148        0.741
   33      3       1   0.1944  0.1219       0.0569        0.664
   43      2       1   0.0972  0.0919       0.0153        0.620
   45      1       1   0.0000     NaN           NA           NA
</code></pre></div>    </div>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot KM broken out by treatment </span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">survfit.aml.by.rx</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Time"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Survival"</span><span class="p">,</span><span class="w">
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> 
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Kaplan-Meier Survival vs. Maintenance in AML"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Add a legend so we know which is which</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Maintained"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Not maintained"</span><span class="p">),</span><span class="w"> 
       </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-17-2.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" width="612" style="display: block; margin: auto;" /></p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Perform the log rank test using the R function survdiff().</span><span class="w">
</span><span class="n">aml.survdiff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survdiff</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">data</span><span class="o">=</span><span class="n">aml</span><span class="p">)</span><span class="w">
</span><span class="n">aml.survdiff</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Call:
survdiff(formula = Surv(time, status == 1) ~ x, data = aml)

                 N Observed Expected (O-E)^2/E (O-E)^2/V
x=Maintained    11        7    10.69      1.27       3.4
x=Nonmaintained 12       11     7.31      1.86       3.4

 Chisq= 3.4  on 1 degrees of freedom, p= 0.07 
</code></pre></div>    </div>

    <p>Extra challenge: there is no function in R to directly plot <script type="math/tex">\lambda(t)</script>, so we have 
to extract the life tables manually. The object created by taking a <code class="highlighter-rouge">summary()</code> of the <code class="highlighter-rouge">survfit()</code> 
object has a variable called <code class="highlighter-rouge">strata</code> that defines the groups by which the comparison is broken down. 
You can use this to subset the life table.</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first we need to assign the life table summary to an object</span><span class="w">
</span><span class="n">aml.lt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">survfit.aml.by.rx</span><span class="p">)</span><span class="w">

</span><span class="c1"># extract age, and number of deaths and number at risk at each age from the</span><span class="w">
</span><span class="c1"># survfit object. We'll do the "Maintained" group first. For some reason the summary</span><span class="w">
</span><span class="c1"># is formatted in rows with a weird notation. It creates a new variable that combines</span><span class="w">
</span><span class="c1"># the header from our original input data with the value in the column; in this case</span><span class="w">
</span><span class="c1"># "x=Maintained" and "x=Nonmaintained". We have to use this to separate out the data</span><span class="w">
</span><span class="n">age.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aml.lt</span><span class="o">$</span><span class="n">time</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Maintained"</span><span class="p">]</span><span class="w">
</span><span class="n">n.event.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aml.lt</span><span class="o">$</span><span class="n">n.event</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Maintained"</span><span class="p">]</span><span class="w">
</span><span class="n">n.risk.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aml.lt</span><span class="o">$</span><span class="n">n.risk</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Maintained"</span><span class="p">]</span><span class="w">

</span><span class="c1"># calculate qt; note that this is an alternative way to get qx from using the lx and</span><span class="w">
</span><span class="c1"># lx+1 values. If you rearrange the life table equations you can derive this form.</span><span class="w">
</span><span class="n">qx.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n.event.main</span><span class="o">/</span><span class="n">n.risk.main</span><span class="w">

</span><span class="c1"># now calculate px and mux (mu is age-specific mortality)</span><span class="w">
</span><span class="n">px.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qx.main</span><span class="w">
</span><span class="n">mux.main</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="n">px.main</span><span class="p">)</span><span class="w">

</span><span class="c1"># for the non-maintenance group, I am just going to combine the above few steps</span><span class="w">
</span><span class="c1"># into a single step.</span><span class="w">
</span><span class="n">age.nomain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">aml.lt</span><span class="o">$</span><span class="n">time</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Nonmaintained"</span><span class="p">]</span><span class="w">
</span><span class="n">mux.nomain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">aml.lt</span><span class="o">$</span><span class="n">n.event</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Nonmaintained"</span><span class="p">]</span><span class="o">/</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">n.risk</span><span class="p">[</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">strata</span><span class="w"> 
</span><span class="o">==</span><span class="w"> </span><span class="s2">"x=Nonmaintained"</span><span class="p">])</span><span class="w">

</span><span class="c1"># Now we can finally plot. Someone should write a function to do this...</span><span class="w">
</span><span class="c1"># Remember to put the y-axis on a log scale.</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">age.main</span><span class="p">,</span><span class="n">mux.main</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.7</span><span class="p">,</span><span class="w">  
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Age"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Age-Specific Mortality"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">time</span><span class="p">),</span><span class="nf">max</span><span class="p">(</span><span class="n">aml.lt</span><span class="o">$</span><span class="n">time</span><span class="p">)))</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="n">age.nomain</span><span class="p">,</span><span class="n">mux.nomain</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.7</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Maintained"</span><span class="p">,</span><span class="s2">"Nonmaintained"</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <p><img src="../fig/rmd-08-class-survival-analysis-unnamed-chunk-18-1.png" title="plot of chunk unnamed-chunk-18" alt="plot of chunk unnamed-chunk-18" width="612" style="display: block; margin: auto;" /></p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="comparison-of-female-vs-male-lifespan-across-strains">Comparison of female vs. male lifespan across strains</h2>

  <p>We saw that lifespan was not significanlty different between female and male BUB/BnJ mice.
Is this universally true for different mouse strains?</p>

  <p>Write a script that does the following using the <code class="highlighter-rouge">inbred.lifespan.txt</code> data:</p>
  <ol>
    <li>Generate a PDF.</li>
    <li>On each page, plot female vs. male lifespan and mortality curves for one strain. Include
the following on each plot (hint: use the <code class="highlighter-rouge">text()</code> function):
      <ul>
        <li>strain name</li>
        <li>Log-Rank P-value</li>
        <li>Tick marks to indicate time of censoring</li>
        <li>Legend to show female vs. male colors</li>
      </ul>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <p>[[UNDER CONSTRUCTION]]</p>
  </blockquote>
</blockquote>

<hr />



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Time-to-event data includes a hybrid of an observation (event vs. no event) and a series of observation times.</p>
</li>
    
    <li><p>Time-to-event data analysis violates several assumptions made by standard tests, including normality and independence of observations.</p>
</li>
    
    <li><p>Censoring complicates analysis and is not handled by standard statistical tests, including the Wilcoxon Rank-Sum test. Instead, we use the Log-Rank test for basic survival comparisons.</p>
</li>
    
    <li><p>Unlike the survival function, age-specific mortality at any given time does not depend on previous observations.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-oyo-multiple-test-correction/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../08-oyo-advanced-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <!--<div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/08-class-survival-analysis.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:sutphin@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>-->
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
<!--<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>-->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </body>
</html>
