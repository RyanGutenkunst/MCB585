















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2019-10-15 00:12:30 -0700">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/mcb585/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/mcb585/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/mcb585/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/mcb585/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/mcb585/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/mcb585/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/mcb585/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/mcb585/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/mcb585/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content=" - MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mcb585/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mcb585/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mcb585/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mcb585/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mcb585/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems: Simulating Experiments</title>
  </head>
  <body>

    



    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://georgesutphin.github.io/MCB585/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/mcb585-logo.svg" alt="MCB585 logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-R-RStudio-setup/index.html">Getting started with R and RStudio</a></li>
            
            <li><a href="../02-introduction-to-R-basics/index.html">Introduction to R -- Best Practices, Data Types, and Data Structures</a></li>
            
            <li><a href="../03-introduction-to-R-data-plotting/index.html">Introduction to R -- Reading, Writing, and Plotting Data</a></li>
            
            <li><a href="../04-introduction-to-R-decisions-and-loops/index.html">Introduction to R -- Decisions and Loops</a></li>
            
            <li><a href="../05-distributions/index.html">Distributions and assessing normality</a></li>
            
            <li><a href="../06-hypothesis-testing/index.html">Hypothesis testing in R</a></li>
            
            <li><a href="../07-power-analysis/index.html">Power Analysis</a></li>
            
            <li><a href="../08-multiple-test-correction/index.html">Multiple Comparisons</a></li>
            
            <li><a href="../09-survival-analysis/index.html">Survival Analysis</a></li>
            
            <li><a href="../10-simulating-experiments/index.html">Simulating Experiments</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	<!--
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	-->

	
        <li><a href="../LICENSE.html">About</a></li>
	<!--
	
	<li><a href="/edit//_episodes_rmd/10-simulating-experiments.Rmd">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	-->
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../09-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">MCB 585: Multidisciplinary/Quantitative Approaches to Solving Biological Problems</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Simulating Experiments</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Class Date:</strong> 10/15/2019
      <br/>
      <strong>Teaching:</strong> 80 min
      <br/>
      <strong>Exercises:</strong> 25 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is a simulated experiment?</p>
</li>
	
	<li><p>What are the applications for simulated experiments?</p>
</li>
	
	<li><p>How can we use simulation to improve (and generalize) power analysis?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Prepare a plan for running an experiment simulation.</p>
</li>
	
	<li><p>Simulate data from an assumed distribution.</p>
</li>
	
	<li><p>Use simulated data to run a series of mock experiments to examine the behavior of a planned analysis.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Simulations have several advantages, for example:</p>
<ul>
  <li>The force you to think through a planned statistical analysis in advance (for best practices, you should be doing this anyway) and work out at least some of the technical issues ahead of time.</li>
  <li>They give valuable insight into the behavior the phenotype that you are studying.</li>
  <li>They can identify problems with experimental design or practical execution that you did not consider in advance.</li>
</ul>

<p>In this class we are going to use a simulation to run a more generalizable form of power analysis. Unlike the functions in the <code class="highlighter-rouge">pwr</code> package, this method can be used on essentially any experimental design for which you have pilot data, or can make a reasonable estimate of the behavior of the data. It does not necessarily rely on specific assumptions about the distribution or nature of the phenotype (though <em>some</em> assumptions will always be required).</p>

<hr />
<h3 id="simulating-power">Simulating power</h3>

<p>In a power analysis, we are usually trying to figure out what sample size we need to be confident in the statistical outcome of an experiment. Why don’t we just run the experiment a bunch of times to see how often we expect different outcomes to occur? Because we have limited resources, and repeating an experiment a hundred or a thousand times just isn’t practical. We usually have the time and resources to run an experiment once (or at most a few times), and we want to know how to get the most bang for our buck. That doesn’t mean we can’t pretend though.</p>

<p>In essence, a simulation is a formalized thought experiment, where we set up an idealized scenario where we know the right answer, pretend to run our experiments over and over again, complete with statistical tests, and see how often our “single” experiments make the right call about the true situation. Here is a basic protocol:</p>

<ol>
  <li>Estimate the behavior of the real phenotype of interest. Usually this involves collection pilot data and making an assumption along one of two lines:
    <ul>
      <li>Assume that the phenotype behaves according to a defined function or distribution and use the pilot data to estimate the exact shape (e.g. assume your phenotype is normally distributed, and use the mean and standard deviation of the pilot data to estimate the shape).</li>
      <li>Assume that your pilot data is identical to your population and use it directly (this usually works if you have a lot of pilot data, say about your control population).</li>
    </ul>
  </li>
  <li>Decide what sort of change in your phenotype of interest is meaningful. Usually this involves making an assumption about how the independent variable will impact your dependent variable (e.g. I am interested in detecting a mean body weight change of 20% without a change in standard deviation).</li>
  <li>Using the information in (1) and (2), formally define your “control” and “treatment” populations with a known change of a magnitude that will be meaningful (to simulate the situation “<script type="math/tex">H_1</script> is true”). Also draw a second random “treatment” sample from your control population (to simulate the situation “<script type="math/tex">H_0</script> is true”)</li>
  <li>Collect a simulated sample of size m and n from your control and treatment groups, respectively (note that m and n can be different). This usually involves drawing randomly from a distribution or pilot data set.</li>
  <li>Conduct a pre-defined statistical test on your “control” vs. “treatment” samples for both situations (<script type="math/tex">H_1</script> is true and <script type="math/tex">H_0</script> is true) and note the outcome.</li>
  <li>Repeat steps (4) and (5) as many times as you like.</li>
  <li>Tabulate the number of times your statistical test accepted or rejected <script type="math/tex">H_0</script> under both “truth” scenarios to generate a hypothesis table.</li>
  <li>Use the four quadrants of the hypothesis table to calculate your simulated <script type="math/tex">\alpha</script>, <script type="math/tex">\beta</script>, and power.</li>
  <li>Repeat for additional effect and sample sizes to draw power reference charts.</li>
</ol>

<p>Let’s use this process to re-examine our power analysis for mouse lifespan. First, we need to know how to sample data.</p>

<hr />
<h3 id="sampling-from-distributions">Sampling from distributions</h3>

<p>Let’s use our inbred lifespan data set to simulate some new lifespan data for C57BL/6J mice. First, load the <code class="highlighter-rouge">inbred.lifespan.txt</code> data and the <code class="highlighter-rouge">survival</code> package. Also define the “status” variable to indicate which mice had a positive observation for the phenotype of interest (death). Recall that this is just the inverse of the already defined <code class="highlighter-rouge">censor</code> variable, which indicates censoring events for mice that were removed from the study prior to dying. Finally, grab the subset of data for just the C57BL/6J mouse strain.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"survival"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load inbred mouse lifespan data</span><span class="w">
</span><span class="n">data.surv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.delim</span><span class="p">(</span><span class="s2">"data/inbred.lifespan.txt"</span><span class="p">)</span><span class="w">

</span><span class="c1"># define status variable to indicate "death" events</span><span class="w">
</span><span class="n">data.surv</span><span class="o">$</span><span class="n">status</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="o">!</span><span class="n">data.surv</span><span class="o">$</span><span class="n">censor</span><span class="p">)</span><span class="w">

</span><span class="c1"># Grab C57BL/6J data subset</span><span class="w">
</span><span class="n">surv.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.surv</span><span class="p">[</span><span class="n">data.surv</span><span class="o">$</span><span class="n">strain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"C57BL/6J"</span><span class="p">,]</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">surv.b6</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      strain sex animal_id lifespan_days censor status
449 C57BL/6J   f        24           333      1      0
450 C57BL/6J   f        25           475      1      0
451 C57BL/6J   f        26           391      1      0
452 C57BL/6J   f       204           272      0      1
453 C57BL/6J   f       205          1049      0      1
454 C57BL/6J   f       206           795      0      1
</code></pre></div></div>

<p>One way to approach this data would be to just use our pilot inbred lifespan data under the assumption that it can represent the “true” population. A better approach, when possible, is to find a distribution that can accurately represent your data. There are some distributions that can do a decent job for lifespan data. The most common are the Gompertz and Weibull distributions.</p>

<p> </p>
<h4 id="gompertz-and-weibull-distributions-for-lifespan-data">Gompertz and Weibull distributions for lifespan data</h4>

<p>As discussed in our previous class on survival analysis, while the population-level survival function, S(t), cannot be considered independently sampled, because each point depends on the value of previous observations, the hazard function, or age-specific mortality function can be modeled based on independent sampling of lifespan. The Gompertz and Weibull assume that the hazard function takes on a specific (and slightly different) form:</p>

<p><img src="../fig/gompertz-weibull.png" alt="Gompertz and Weibull assumptions" /></p>

<p> </p>

<p>More information and the R functions for dealing with a Gompertz distribution are available in the <code class="highlighter-rouge">flexsurv</code> package. For our purposes, and within the <code class="highlighter-rouge">survival</code> package, we will primarily deal with the Weibull distribution. In the above equations, <script type="math/tex">\gamma</script> is called the <em>shape</em> and <script type="math/tex">\lambda</script> is called the scale. For shape, the following hold:</p>
<ul>
  <li><script type="math/tex">% <![CDATA[
\gamma < 1 %]]></script> indicates that the failure rate (aka mortality) is decreasing over time, such as infant mortality rates.</li>
  <li><script type="math/tex">\gamma = 1</script> indicates a constant failure rate, such as that for many types of machinery. The Weibull distribution simply collapses to the exponential distributions.</li>
  <li><script type="math/tex">\gamma > 1</script> indicates an increasing failure rate, which is what we see during aging.</li>
</ul>

<p>In contrast, the scale parameter <script type="math/tex">\lambda</script> simply defines the relative rate at which the hazard is increasing. If we make the assumption that our lifespan data falls within a Weibull distribution, we can use the <code class="highlighter-rouge">survreg()</code> function to identify the shape and scale parameters that best fit our survival data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># calculate parameters for Weibull distribution</span><span class="w">
</span><span class="n">wei.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survreg</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.b6</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"weibull"</span><span class="p">)</span><span class="w">

</span><span class="c1"># There are multiple ways to parameterize a Weibull distribution. The survreg </span><span class="w">
</span><span class="c1"># function embeds it in a general location-scale family, which is a </span><span class="w">
</span><span class="c1"># different parameterization than the rweibull function, and often leads</span><span class="w">
</span><span class="c1"># to confusion.</span><span class="w">
</span><span class="c1">#   survreg's scale  =    1/(rweibull shape)</span><span class="w">
</span><span class="c1">#   survreg's intercept = log(rweibull scale)</span><span class="w">

</span><span class="c1"># based on the above, calculate scale and shape for rweibull</span><span class="w">
</span><span class="n">shape.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">wei.b6</span><span class="o">$</span><span class="n">scale</span><span class="w">
</span><span class="n">scale.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="n">wei.b6</span><span class="o">$</span><span class="n">coefficients</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p> </p>

<p>And using these shape and scale parameters, we can now use the <code class="highlighter-rouge">rweibull()</code> function to randomly draw a requested number of samples from the corresponding Weibull distribution.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">samp.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
</span><span class="n">samp.b6</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 558.3704 638.3484 685.8631 952.6065 927.2090 900.6943 935.2129
 [8] 969.5803 784.0098 780.0027
</code></pre></div></div>

<p> </p>

<p>As a first order confirmation, note that these values are in the same range as the real lifespan values for C57BL/6J mice in our data set. Based on the equation for hazard, we can use the <code class="highlighter-rouge">scale</code> parameter to define a desired change in lifespan:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># define change</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span><span class="w"> </span><span class="c1"># 20% change in lifespan</span><span class="w">

</span><span class="c1"># sample a distribution with a 20% increase in scale</span><span class="w">
</span><span class="n">samp.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.2</span><span class="o">*</span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
</span><span class="n">samp.b6</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1]  998.5732 1123.2947 1165.0339 1159.2537 1269.1482  970.3824 1141.7878
 [8] 1118.1884 1287.7089 1143.2514
</code></pre></div></div>

<p> </p>

<p>To test the sampling procedure, let’s draw 10 random samples from both the “control” population, and a population with a 20% increase in lifespan, and plot the survival curves all together along with the survival curves from the original sample.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># first define the survival curve for the original sample</span><span class="w">
</span><span class="n">survfit.real</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.b6</span><span class="p">)</span><span class="w">

</span><span class="c1"># plot the real survival data</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">survfit.real</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> 
     </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="c1"># make this line black and thicker</span><span class="w">
     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1.5</span><span class="o">*</span><span class="nf">max</span><span class="p">(</span><span class="n">surv.b6</span><span class="o">$</span><span class="n">lifespan_days</span><span class="p">)))</span><span class="w"> </span><span class="c1"># make the x-axis plenty large enough for the next set</span><span class="w">

</span><span class="c1"># run through 10 iterations</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># select a sample of 100 from the estimated "control" and "treatment" Weibull distributions</span><span class="w">
  </span><span class="n">samp.ctrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
  </span><span class="n">samp.treat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.2</span><span class="o">*</span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># calculate survfit objects (note that we are assuming no censoring here)</span><span class="w">
  </span><span class="n">survfit.ctrl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">samp.ctrl</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">samp.ctrl</span><span class="p">)))</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">survfit.treat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survfit</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">samp.treat</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">samp.treat</span><span class="p">)))</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># add lines to the existing plot for current set</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">survfit.ctrl</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lightblue"</span><span class="p">)</span><span class="w">
  </span><span class="n">lines</span><span class="p">(</span><span class="n">survfit.treat</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-10-simulating-experiments-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>That looks like a pretty decent estimate, and gives some idea of what variation to expect, even with a relatively large sample size (100). Now let’s look at how to use that same approach to calculate power.</p>

<hr />
<h3 id="power-analysis-by-simulation">Power analysis by simulation</h3>

<p>For the purposes of this example, we want to know how large we need our sample size to be in order to detect a 20% change at 90% power at a significance level of 0.05 using a log-rank test. As noted above, this style of power analysis always takes in a value for effect size, sample size, and significance level and generates power as an output. What we need to do is run a simulated experiment with a range of sample sizes and figure out which generates a sufficiently high simulated power. Here is how we go about it:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># set power parameters</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.05</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.2</span><span class="w">

</span><span class="c1"># set range of sample sizes</span><span class="w">
</span><span class="n">n.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="c1"># initialize data frame to store power and alpha values for each sample size</span><span class="w">
</span><span class="n">outcome</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n.vec</span><span class="p">,</span><span class="w"> 
                      </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="kc">NA</span><span class="p">),</span><span class="w">
                      </span><span class="n">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="kc">NA</span><span class="p">))</span><span class="w">

</span><span class="c1"># set number of simulated samples</span><span class="w">
</span><span class="n">n.samp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">

</span><span class="c1"># calculate parameters for Weibull distribution</span><span class="w">
</span><span class="n">wei.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survreg</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan_days</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.b6</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"weibull"</span><span class="p">)</span><span class="w">
</span><span class="n">shape.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">wei.b6</span><span class="o">$</span><span class="n">scale</span><span class="w">
</span><span class="n">scale.b6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">exp</span><span class="p">(</span><span class="n">wei.b6</span><span class="o">$</span><span class="n">coefficients</span><span class="p">))</span><span class="w">

</span><span class="c1"># start by cycling through sample sizes</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">n.vec</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c1"># grab current sample size</span><span class="w">
  </span><span class="n">n.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n.vec</span><span class="p">[</span><span class="n">i.n</span><span class="p">]</span><span class="w">

  </span><span class="c1"># initialize matrix to record whether null hypothesis was accepted or rejected</span><span class="w">
  </span><span class="n">outcome.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">Sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n.samp</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="m">0</span><span class="n">.True</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">H</span><span class="m">1</span><span class="n">.True</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="kc">NA</span><span class="p">))</span><span class="w">
  
  </span><span class="c1"># start sampling procedure -- for each iteration, do the following:</span><span class="w">
  </span><span class="c1">#  1. generate test sample from each distribution (control, </span><span class="w">
  </span><span class="c1">#     control (H0 true) and simulated 20% extension (H1 true))</span><span class="w">
  </span><span class="c1">#  2. run a log rank test to determine what we would conclude given</span><span class="w">
  </span><span class="c1">#     the current sample</span><span class="w">
  </span><span class="c1">#  3. record outcome for both comparisons to the outcome matrix</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i.samp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n.samp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># print every 100 samples</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">i.samp</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">250</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Now starting sample"</span><span class="p">,</span><span class="n">i.samp</span><span class="p">,</span><span class="w"> </span><span class="s2">"for sample size"</span><span class="p">,</span><span class="n">n.c</span><span class="p">))</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c1"># generate control sample and embed in test data frame</span><span class="w">
    </span><span class="n">samp.ctrl.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="n">n.c</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
    </span><span class="n">surv.ctrl.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">lifespan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samp.ctrl.c</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"control"</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># generate test sample assuming H0 is true</span><span class="w">
    </span><span class="n">samp.test.H0true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="n">n.c</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
    </span><span class="n">surv.test.H0true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">lifespan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samp.test.H0true.c</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># generate test sample assuming H1 is true</span><span class="w">
    </span><span class="n">samp.test.H1true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rweibull</span><span class="p">(</span><span class="n">n.c</span><span class="p">,</span><span class="w"> </span><span class="n">shape.b6</span><span class="p">,</span><span class="w"> </span><span class="n">scale.b6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">change</span><span class="o">*</span><span class="n">scale.b6</span><span class="p">)</span><span class="w">
    </span><span class="n">surv.test.H1true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">lifespan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">samp.test.H1true.c</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># setup data frames for H0 and H1 true for testing</span><span class="w">
    </span><span class="n">surv.H0true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">surv.ctrl.c</span><span class="p">,</span><span class="w"> </span><span class="n">surv.test.H0true.c</span><span class="p">)</span><span class="w">
    </span><span class="n">surv.H1true.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">surv.ctrl.c</span><span class="p">,</span><span class="w"> </span><span class="n">surv.test.H1true.c</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># run log-rank test</span><span class="w">
    </span><span class="n">logrank.H0true</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survdiff</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.H0true.c</span><span class="p">)</span><span class="w">
    </span><span class="n">logrank.H1true</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">survdiff</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">lifespan</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surv.H1true.c</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># calculate P-values from logrank chisq statistics</span><span class="w">
    </span><span class="n">p.H0true</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pchisq</span><span class="p">(</span><span class="n">logrank.H0true</span><span class="o">$</span><span class="n">chisq</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">logrank.H0true</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
    </span><span class="n">p.H1true</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pchisq</span><span class="p">(</span><span class="n">logrank.H1true</span><span class="o">$</span><span class="n">chisq</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">logrank.H1true</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># record outcome (1 = accept H0, 0 = reject H0)</span><span class="w">
    </span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">0</span><span class="n">.True</span><span class="p">[</span><span class="n">i.samp</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">p.H0true</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
    </span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">1</span><span class="n">.True</span><span class="p">[</span><span class="n">i.samp</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">p.H1true</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="c1"># Build hypothesis table</span><span class="w">
  </span><span class="n">h.table.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">outcome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Accept H0"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Reject H0"</span><span class="p">),</span><span class="w"> 
                         </span><span class="n">H</span><span class="m">0</span><span class="n">.true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">0</span><span class="n">.True</span><span class="p">),</span><span class="w"> </span><span class="n">n.samp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">0</span><span class="n">.True</span><span class="p">)),</span><span class="w">
                         </span><span class="n">H</span><span class="m">1</span><span class="n">.true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">1</span><span class="n">.True</span><span class="p">),</span><span class="w"> </span><span class="n">n.samp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">outcome.c</span><span class="o">$</span><span class="n">H</span><span class="m">1</span><span class="n">.True</span><span class="p">)))</span><span class="w">
  
  </span><span class="c1"># update power and significance data frames</span><span class="w">
  </span><span class="n">outcome</span><span class="o">$</span><span class="n">alpha</span><span class="p">[</span><span class="n">i.n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">h.table.c</span><span class="o">$</span><span class="n">H</span><span class="m">0</span><span class="n">.true</span><span class="p">[</span><span class="n">h.table.c</span><span class="o">$</span><span class="n">outcome</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Reject H0"</span><span class="p">]</span><span class="o">/</span><span class="n">n.samp</span><span class="w">
  </span><span class="n">outcome</span><span class="o">$</span><span class="n">power</span><span class="p">[</span><span class="n">i.n</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">h.table.c</span><span class="o">$</span><span class="n">H</span><span class="m">1</span><span class="n">.true</span><span class="p">[</span><span class="n">h.table.c</span><span class="o">$</span><span class="n">outcome</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Reject H0"</span><span class="p">]</span><span class="o">/</span><span class="n">n.samp</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1] "Now starting sample 250 for sample size 5"
[1] "Now starting sample 500 for sample size 5"
[1] "Now starting sample 750 for sample size 5"
[1] "Now starting sample 1000 for sample size 5"
[1] "Now starting sample 250 for sample size 10"
[1] "Now starting sample 500 for sample size 10"
[1] "Now starting sample 750 for sample size 10"
[1] "Now starting sample 1000 for sample size 10"
[1] "Now starting sample 250 for sample size 15"
[1] "Now starting sample 500 for sample size 15"
[1] "Now starting sample 750 for sample size 15"
[1] "Now starting sample 1000 for sample size 15"
[1] "Now starting sample 250 for sample size 20"
[1] "Now starting sample 500 for sample size 20"
[1] "Now starting sample 750 for sample size 20"
[1] "Now starting sample 1000 for sample size 20"
[1] "Now starting sample 250 for sample size 25"
[1] "Now starting sample 500 for sample size 25"
[1] "Now starting sample 750 for sample size 25"
[1] "Now starting sample 1000 for sample size 25"
[1] "Now starting sample 250 for sample size 30"
[1] "Now starting sample 500 for sample size 30"
[1] "Now starting sample 750 for sample size 30"
[1] "Now starting sample 1000 for sample size 30"
[1] "Now starting sample 250 for sample size 35"
[1] "Now starting sample 500 for sample size 35"
[1] "Now starting sample 750 for sample size 35"
[1] "Now starting sample 1000 for sample size 35"
[1] "Now starting sample 250 for sample size 40"
[1] "Now starting sample 500 for sample size 40"
[1] "Now starting sample 750 for sample size 40"
[1] "Now starting sample 1000 for sample size 40"
[1] "Now starting sample 250 for sample size 45"
[1] "Now starting sample 500 for sample size 45"
[1] "Now starting sample 750 for sample size 45"
[1] "Now starting sample 1000 for sample size 45"
[1] "Now starting sample 250 for sample size 50"
[1] "Now starting sample 500 for sample size 50"
[1] "Now starting sample 750 for sample size 50"
[1] "Now starting sample 1000 for sample size 50"
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># show outcome</span><span class="w">
</span><span class="n">outcome</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    N alpha power
1   5 0.065 0.441
2  10 0.057 0.741
3  15 0.072 0.917
4  20 0.046 0.965
5  25 0.068 0.986
6  30 0.046 0.998
7  35 0.056 0.999
8  40 0.050 1.000
9  45 0.048 1.000
10 50 0.057 1.000
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Check out the distribution of calculated alphas</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">outcome</span><span class="o">$</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-10-simulating-experiments-unnamed-chunk-7-1.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" width="612" style="display: block; margin: auto;" /></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># generate power plot to compare power vs. sample size</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">outcome</span><span class="o">$</span><span class="n">power</span><span class="p">,</span><span class="w"> </span><span class="n">outcome</span><span class="o">$</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">"Power analysis for 20% change in\nC57BL/6J lifespan (alpha = 0.05)"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sample Size"</span><span class="p">,</span><span class="w"> 
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Power"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../fig/rmd-10-simulating-experiments-unnamed-chunk-7-2.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" width="612" style="display: block; margin: auto;" /></p>

<p> </p>

<p>It looks like we need somewhere around 16 mice to detect a 20% change in C57BL/6J lifespan at <script type="math/tex">\alpha = 0.05</script>.</p>

<p>Note that the precision of the power and significance calculated based on the simulation is strictly determined by the number of times we run the simulated experiment. If we only run 100 iterations, we will only be able to distinguish a significance level or power differences down to 1/100 = 0.01.</p>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Experiment simulations can be used to understand the behavior of an idealized system (i.e. a system lacking noise from sources like subjective observation and measurement error).</p>
</li>
    
    <li><p>Power analyses can be conducted using pilot data and (potentially) removing assumptions about distribution.</p>
</li>
    
    <li><p>In essence, an experiment simulation is used to build a ‘real’ sampling distribution from which to draw statistical parameters like significance and power.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../09-survival-analysis/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <!--<div class="row">
    <div class="col-md-6 copyright" align="left">
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/10-simulating-experiments.Rmd">Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION">Cite</a>
	/
	<a href="mailto:sutphin@gmail.com">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>-->
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
<!--<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>-->
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  </body>
</html>
